import hashlib
from cryptography.hazmat.primitives import serialization

# Твой ключ (из переписки)
pem_key = b"""-----BEGIN PRIVATE KEY-----
MIIBUQIBADANBgkqhkiG9w0BAQEFAASCATswggE3AgEAAkA4wvUChmqa9BWA/s99
q2z0OMxVEuDZ8esFuQGJgzfhFrdnmTTJ6APRg2v8xBlxLIghPFZIwEx/VXcqk2Xf
A9FDAgMBAAECQBzoniR1FSJqIfGa1U5p2onfy6Gghcg6f7pgaToCDJmkkPJrnTFg
yEX9TJnQDmoGtC94hXLXWhQWIOHhipl7vNECIEqMnfiP56WFh0qdmAmCBJX4gjww
LPd68EY+WeUi6divAiEAwureZmrzJf7BCc1GC6djuN1rkoAMnTGNkor8EJCcja0C
IEHQwUqHqagtKdNLLMYAHpJUko4WrixTQjuRooWz/CYLAiA39vnOTEzuDtxcNR00
gWZHkQOu96cnhy/P8Kn5E5xvrQIgHo+Vz5gwKn3Mq0SIY7vAZ3bSBuwcF3Mx4KwS
vsRnhZE=
-----END PRIVATE KEY-----"""

# Загружаем параметры ключа
private_key = serialization.load_pem_private_key(pem_key, password=None)
pn = private_key.private_numbers()
d = pn.d
n = pn.public_numbers.n

message = b"1234"
msg_hash = hashlib.sha256(message).digest()

print(f"[*] Message: {message.decode()}")
print(f"[*] Hash (SHA256): {msg_hash.hex()[:10]}...")

# --- Вариант 1: Стандартный (Big Endian) ---
# Мы это уже пробовали, но пусть будет для контроля.
m_int_be = int.from_bytes(msg_hash, 'big')
sig_int_be = pow(m_int_be, d, n)
sig_hex_be = format(sig_int_be, '0128x')

# --- Вариант 2: Little Endian Input (Перевернутый хэш) ---
# Сервер читает байты хэша задом наперед перед возведением в степень.
m_int_le = int.from_bytes(msg_hash, 'little')
sig_int_le = pow(m_int_le, d, n)
# Результат выводим как обычно (Big Endian Hex)
sig_hex_le_in = format(sig_int_le, '0128x')

# --- Вариант 3: Little Endian Output (Перевернутая подпись) ---
# Математика стандартная, но результат (число) конвертируется в байты задом наперед.
sig_bytes_le = sig_int_be.to_bytes(64, 'little')
sig_hex_le_out = sig_bytes_le.hex()

print("\n--- ПОПРОБУЙ ЭТИ ВАРИАНТЫ ПО ОЧЕРЕДИ ---")

print(f"\n[Вариант 1] Raw RSA (Big Endian - Стандарт):")
print(sig_hex_be)

print(f"\n[Вариант 2] Raw RSA (Little Endian INPUT - Вероятно!):")
# Если сервер написан на C/C++ и кастует байты в int
print(sig_hex_le_in)

print(f"\n[Вариант 3] Raw RSA (Little Endian OUTPUT):")
# Если сервер пишет результат в память задом наперед
print(sig_hex_le_out)



-----BEGIN PRIVATE KEY-----
MIIBUQIBADANBgkqhkiG9w0BAQEFAASCATswggE3AgEAAkA4wvUChmqa9BWA/s99
q2z0OMxVEuDZ8esFuQGJgzfhFrdnmTTJ6APRg2v8xBlxLIghPFZIwEx/VXcqk2Xf
A9FDAgMBAAECQBzoniR1FSJqIfGa1U5p2onfy6Gghcg6f7pgaToCDJmkkPJrnTFg
yEX9TJnQDmoGtC94hXLXWhQWIOHhipl7vNECIEqMnfiP56WFh0qdmAmCBJX4gjww
LPd68EY+WeUi6divAiEAwureZmrzJf7BCc1GC6djuN1rkoAMnTGNkor8EJCcja0C
IEHQwUqHqagtKdNLLMYAHpJUko4WrixTQjuRooWz/CYLAiA39vnOTEzuDtxcNR00
gWZHkQOu96cnhy/P8Kn5E5xvrQIgHo+Vz5gwKn3Mq0SIY7vAZ3bSBuwcF3Mx4KwS
vsRnhZE=
-----END PRIVATE KEY-----
