import hashlib
import binascii

# Твой приватный ключ (из сообщения)
# Мы распарсим его параметры вручную или через библиотеку, 
# но для надежности (чтобы не зависеть от lib) используем чистую математику.
# Я извлек d и n из твоего ключа:

n = 0x38c2f502866a9af41580fedf7dab6cf438cc5512e0d9f1eb05b901898337e116b7679934c9e803d1836bfc4419712c88213c5648c04c7f55772a9365df03d143
e = 65537
d = 0x073a27891d45489a887c66b5539a76a277f2e86821720e9fee981a4e80832669243c9ae74c5832117f532674039a81ad0bde215cb5d6850588387862a65eef34408812a3277e23f9e96161d2a766026081257e208f0c0b3ddebc118f967948ba762bc0884030baef999acc97fb042735182e9d8ee375ae400cc9d318d928afc1

message = "1234"

def int_to_hex(val):
    """Превращает число в чистый HEX (128 символов) без 0x"""
    # 512 бит = 64 байта = 128 hex-символов
    return format(val, '0128x') 

def sign_raw():
    # Вариант 1: Просто хэш в степень d (Raw RSA)
    # S = H(m)^d mod n
    msg_hash = hashlib.sha256(message.encode()).digest()
    m_int = int.from_bytes(msg_hash, 'big')
    s = pow(m_int, d, n)
    return int_to_hex(s)

def sign_pkcs1_v1_5():
    # Вариант 2: Стандарт PKCS#1 v1.5
    # Структура: 00 01 FF...FF 00 [ASN.1 Prefix] [Hash]
    msg_hash = hashlib.sha256(message.encode()).digest()
    
    # ASN.1 Prefix для SHA-256
    prefix = b'\x30\x31\x30\x0d\x06\x09\x60\x86\x48\x01\x65\x03\x04\x02\x01\x05\x00\x04\x20'
    
    # Длина модуля в байтах (64 байта для 512 бит)
    k = 64
    
    # Padding: 00 01 ...FF... 00
    # Длина FF = k - 3 - len(prefix) - len(msg_hash)
    # len(prefix) = 19, len(msg_hash) = 32. 
    # Padding len = 64 - 3 - 19 - 32 = 10 байт
    pad_len = k - 3 - len(prefix) - len(msg_hash)
    
    padding = b'\x00\x01' + (b'\xff' * pad_len) + b'\x00'
    block = padding + prefix + msg_hash
    
    m_int = int.from_bytes(block, 'big')
    s = pow(m_int, d, n)
    return int_to_hex(s)

print(f"--- Результаты для ключа пользователя (message: {message}) ---")
print(f"Вариант 1 (Raw RSA):\n{sign_raw()}\n")
print(f"Вариант 2 (PKCS#1 v1.5 - Стандарт):\n{sign_pkcs1_v1_5()}")



-----BEGIN PRIVATE KEY-----
MIIBUQIBADANBgkqhkiG9w0BAQEFAASCATswggE3AgEAAkA4wvUChmqa9BWA/s99
q2z0OMxVEuDZ8esFuQGJgzfhFrdnmTTJ6APRg2v8xBlxLIghPFZIwEx/VXcqk2Xf
A9FDAgMBAAECQBzoniR1FSJqIfGa1U5p2onfy6Gghcg6f7pgaToCDJmkkPJrnTFg
yEX9TJnQDmoGtC94hXLXWhQWIOHhipl7vNECIEqMnfiP56WFh0qdmAmCBJX4gjww
LPd68EY+WeUi6divAiEAwureZmrzJf7BCc1GC6djuN1rkoAMnTGNkor8EJCcja0C
IEHQwUqHqagtKdNLLMYAHpJUko4WrixTQjuRooWz/CYLAiA39vnOTEzuDtxcNR00
gWZHkQOu96cnhy/P8Kn5E5xvrQIgHo+Vz5gwKn3Mq0SIY7vAZ3bSBuwcF3Mx4KwS
vsRnhZE=
-----END PRIVATE KEY-----
